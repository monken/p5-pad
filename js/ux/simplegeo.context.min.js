(function(t,p){(function(q){var e=t.simplegeo;if(e===p)e={};if(e.Client===p){e.Client=function(c,a){if(!(this instanceof e.Client))return new e.Client(c,a);a=a||{};this.token=c;this.options=a;this.host=a.host||"api.simplegeo.com";this.port=a.port||"80";this.apiUrl="http://"+this.host+":"+this.port;this.name="Client"};var m=t.navigator;e.Client.prototype={request:function(c,a,d){a.token=this.token;a=q.param(a)+"&callback=?";q.ajax({url:this.apiUrl+c,dataType:"json",data:a,success:function(j){if(j.error){var n=
Error(j.message);n.code=j.code;d(n)}else d(null,j.data)},error:function(j,n,u){d(u)}})},getFeature:function(c,a,d){if(d===p){d=a;a={}}return this.request("/1.0/features/"+c+".json",a,d)},watchLocationFromBrowser:function(c,a){if(a===p){a=c;c={}}m&&m.geolocation?m.geolocation.watchPosition(function(d){d.source="navigator";a(null,d)},function(d){a(d)},c):a(Error("navigator.geolocation not available"))},getLocationFromBrowser:function(c,a){if(a===p){a=c;c={}}m&&m.geolocation?m.geolocation.getCurrentPosition(function(d){d.source=
"navigator";a(null,d)},function(d){a(d)},c):a(Error("navigator.geolocation not available"))},getLocationFromIP:function(c,a){var d;if(a===p){a=c;d="/0.1/locate.json"}else d="/0.1/locate/"+c+".json";return this.request(d,{},function(j,n){j?a(j):a(null,{coords:{latitude:n.geometry.coordinates[1],longitude:n.geometry.coordinates[0],accuracy:1E5},timestamp:new Date,source:"simplegeo"})})},getLocation:function(c,a){var d=this;if(a===p){a=c;c={}}d.getLocationFromBrowser(c,function(j,n){j?d.getLocationFromIP(a):
a(null,n)})}}}e.ContextClient=function(c,a){if(!(this instanceof e.ContextClient))return new e.ContextClient(c,a);e.Client.call(this,c,a);this.name="ContextClient"};e.ContextClient.prototype=new e.Client;e.ContextClient.prototype.getContext=function(c,a,d){return this.request("/1.0/context/"+c+","+a+".json",{},d)};e.ContextClient.prototype.getContextFromIP=function(c,a){if(a===p){a=c;c="ip"}return this.request("/1.0/context/"+c+".json",{},a)};e.ContextClient.prototype.getContextFromAddress=function(c,
a){return this.request("/1.0/context/address.json",{address:c},a)};t.simplegeo=e})(function(q,e){var m=q.document,c=(new Date).getTime(),a=/=\?(&|$)/,d=/(\?|&)_=.*?(&|$)/,j=/\?/,n=/%20/g,u=Object.prototype.toString,o={isFunction:function(b){return u.call(b)==="[object Function]"},isArray:function(b){return u.call(b)==="[object Array]"},each:function(b,g,i){var k,l=0,h=b.length,f=h===e||o.isFunction(b);if(i)if(f)for(k in b){if(g.apply(b[k],i)===false)break}else for(;l<h;){if(g.apply(b[l++],i)===false)break}else if(f)for(k in b){if(g.call(b[k],
k,b[k])===false)break}else for(i=b[0];l<h&&g.call(i,l,i)!==false;i=b[++l]);return b},param:function(b){function g(h,f){if(o.isArray(f))o.each(f,function(s,r){/\[\]$/.test(h)?i(h,r):g(h+"["+(typeof r==="object"||o.isArray(r)?s:"")+"]",r)});else f!=null&&typeof f==="object"?o.each(f,function(s,r){g(h+"["+s+"]",r)}):i(h,f)}function i(h,f){f=o.isFunction(f)?f():f;k[k.length]=encodeURIComponent(h)+"="+encodeURIComponent(f)}var k=[];if(o.isArray(b)||b.jquery)o.each(b,function(){i(this.name,this.value)});
else for(var l in b)g(l,b[l]);return k.join("&").replace(n,"+")},ajax:function(b){var g,i;if(b.data&&typeof b.data!=="string")b.data=o.param(b.data);g=b.jsonpCallback||"jsonp"+c++;if(b.data)b.data=(b.data+"").replace(a,"="+g+"$1");b.url=b.url.replace(a,"="+g+"$1");q[g]=q[g]||function(s){i=s;b.success&&b.success.call(b,i,void 0);b.complete&&b.complete.call(b,e,void 0);q[g]=e;try{delete q[g]}catch(r){}h&&h.removeChild(f)};var k=(new Date).getTime(),l=b.url.replace(d,"$1_="+k+"$2");b.url=l+(l===b.url?
(j.test(b.url)?"&":"?")+"_="+k:"");b.url+=(j.test(b.url)?"&":"?")+b.data;var h=m.getElementsByTagName("head")[0]||m.documentElement,f=m.createElement("script");f.src=b.url;h.insertBefore(f,h.firstChild);return e}};return o}(t))})(window);
